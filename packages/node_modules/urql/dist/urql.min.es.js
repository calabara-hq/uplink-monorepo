import{createClient as e,createRequest as r}from"@urql/core";export*from"@urql/core";import{createContext as t,useContext as n,useRef as u,useState as a,useCallback as i,useEffect as o,useMemo as c}from"react";import{toPromise as s,subscribe as f,onPush as v,takeWhile as l,onEnd as d}from"wonka";var p=t(e({url:"/graphql"})),y=p.Provider,x=p.Consumer;p.displayName="UrqlContext";var h=()=>n(p),g={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},q=(e,r)=>{var t={...e,...r,data:void 0!==r.data||r.error?r.data:e.data,fetching:!!r.fetching,stale:!!r.stale};return((e,r)=>{if("object"!=typeof e||"object"!=typeof r)return e!==r;for(var t in e)if(!(t in r))return!0;for(var n in r)if(e[n]!==r[n])return!0;return!1})(e,t)?t:e},b=(e,r)=>{for(var t=0,n=r.length;t<n;t++)if(e[t]!==r[t])return!0;return!1};function k(e){var t=u(!0),n=h(),[c,f]=a(g),v=i(((u,a)=>(f({...g,fetching:!0}),s(n.executeMutation(r(e,u),a||{})).then((e=>(t.current&&f({fetching:!1,stale:!!e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation}),e))))),[n,e,f]);return o((()=>(t.current=!0,()=>{t.current=!1})),[]),[c,v]}function m(e,t){var n=u(void 0);return c((()=>{var u=r(e,t);return void 0!==n.current&&n.current.key===u.key?n.current:(n.current=u,u)}),[e,t])}function P(e){var r=h(),t=(e=>{if(!e._react){var r=new Set,t=new Map;e.operations$&&f((e=>{"teardown"===e.kind&&r.has(e.key)&&(r.delete(e.key),t.delete(e.key))}))(e.operations$),e._react={get:e=>t.get(e),set(e,n){r.delete(e),t.set(e,n)},dispose(e){r.add(e)}}}return e._react})(r),n=((e,r)=>e.suspense&&(!r||!1!==r.suspense))(r,e.context),u=m(e.query,e.variables),s=c((()=>{if(e.pause)return null;var a=r.executeQuery(u,{requestPolicy:e.requestPolicy,...e.context});return n?v((e=>{t.set(u.key,e)}))(a):a}),[t,r,u,n,e.pause,e.requestPolicy,e.context]),p=i(((e,r)=>{if(!e)return{fetching:!1};var n=t.get(u.key);if(n){if(r&&null!=n&&"then"in n)throw n}else{var a,i=f((e=>{n=e,a&&a(n)}))(l((()=>r&&!a||!n))(e));if(null==n&&r){var o=new Promise((e=>{a=e}));throw t.set(u.key,o),o}i.unsubscribe()}return n||{fetching:!0}}),[t,u]),y=[r,u,e.requestPolicy,e.context,e.pause],[x,k]=a((()=>[s,q(g,p(s,n)),y])),P=x[1];s!==x[0]&&b(x[2],y)&&k([s,P=q(x[1],p(s,n)),y]),o((()=>{var e=x[0],r=x[2][1],n=!1,u=e=>{n=!0,k((r=>{var t=q(r[1],e);return r[1]!==t?[r[0],t,r[2]]:r}))};if(e){var a=f(u)(d((()=>{u({fetching:!1})}))(e));return n||u({fetching:!0}),()=>{t.dispose(r.key),a.unsubscribe()}}u({fetching:!1})}),[t,x[0],x[2][1]]);var w=i((a=>{var i={requestPolicy:e.requestPolicy,...e.context,...a};k((e=>[n?v((e=>{t.set(u.key,e)}))(r.executeQuery(u,i)):r.executeQuery(u,i),e[1],y]))}),[r,t,u,n,p,e.requestPolicy,e.context]);return[P,w]}function w(e,r){var t=h(),n=m(e.query,e.variables),s=u(r);s.current=r;var v=c((()=>e.pause?null:t.executeSubscription(n,e.context)),[t,n,e.pause,e.context]),l=[t,n,e.context,e.pause],[p,y]=a((()=>[v,{...g,fetching:!!v},l])),x=p[1];v!==p[0]&&b(p[2],l)&&y([v,x=q(p[1],{fetching:!!v}),l]),o((()=>{var e=e=>{y((r=>{var t=q(r[1],e);return r[1]===t?r:(s.current&&r[1].data!==t.data&&(t.data=s.current(r[1].data,t.data)),[r[0],t,r[2]])}))};if(p[0])return f(e)(d((()=>{e({fetching:!!v})}))(p[0])).unsubscribe;e({fetching:!1})}),[p[0]]);var k=i((r=>{var u=t.executeSubscription(n,{...e.context,...r});y((e=>[u,e[1],l]))}),[t,e.context,n]);return[x,k]}function Q(e){var r=k(e.query);return e.children({...r[0],executeMutation:r[1]})}function S(e){var r=P(e);return e.children({...r[0],executeQuery:r[1]})}function M(e){var r=w(e,e.handler);return e.children({...r[0],executeSubscription:r[1]})}export{x as Consumer,p as Context,Q as Mutation,y as Provider,S as Query,M as Subscription,h as useClient,k as useMutation,P as useQuery,w as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
