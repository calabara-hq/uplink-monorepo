name: Staging CI/CD

on:
  push:
    branches: [ staging ]

jobs:         
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v2
#       - name: Get short sha
#         id: get_sha
#         run: echo "sha_short=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT
#       - name: Set up Docker Buildx
#         uses: docker/setup-buildx-action@v1
        
#       - name: Login to DockerHub
#         uses: docker/login-action@v1
#         with:
#           username: ${{ secrets.DOCKER_USERNAME }}
#           password: ${{ secrets.DOCKER_PASSWORD }}

#       - name: Build and push docker images
#         run: |
#           export GITHUB_SHA_TAG=${{ steps.get_sha.outputs.sha_short }}
#           docker-compose -f uplink-hub/docker-compose.yaml build
#           docker-compose -f uplink-hub/docker-compose.yaml push
          

          
  create-release:
    #needs: [build]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Bump version and push tag
      id: create_tag
      uses: anothrNick/github-tag-action@1.64.0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        WITH_V: false
        DEFAULT_BUMP: patch
        PRERELEASE: true
        
    - name: Create Release Branch
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git checkout -b release-${{ steps.create_tag.outputs.new_tag }}
        git push origin release-${{ steps.create_tag.outputs.new_tag }}

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        branch: release-${{ steps.create_tag.outputs.new_tag }}
        base: main
        title: 'Release ${{ steps.create_tag.outputs.new_tag }}'
        body: 'Release of version ${{ steps.create_tag.outputs.new_tag }}'
    
    
